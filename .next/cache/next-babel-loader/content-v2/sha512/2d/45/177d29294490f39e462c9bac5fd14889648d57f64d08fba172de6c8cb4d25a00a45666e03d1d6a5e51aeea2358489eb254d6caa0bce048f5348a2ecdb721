{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/paulo/Desktop/Private_Blockchain/Web/WebApp/pages/data/show.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { Form, Button, Message, Table, Grid, Modal } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport getEvents from \"../../components/getEvents\";\nimport getTags from \"../../components/getTags\";\nimport decodeData from \"../../components/decodeData\";\nimport web3 from \"../../Ethereum/web3\";\nimport contract2 from \"../../Ethereum/contract2\";\nimport Common from \"ethereumjs-common\";\n\nvar Tx = require(\"ethereumjs-tx\");\n\nvar Show = /*#__PURE__*/function (_Component) {\n  _inherits(Show, _Component);\n\n  var _super = _createSuper(Show);\n\n  function Show() {\n    var _this;\n\n    _classCallCheck(this, Show);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      buyer_add: \"\",\n      errorMessage: \"\",\n      successMessage: \"\",\n      loading: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n        var timestamp, e, decodedData, dataID, addressFrom, transferValue, recipient, privateKey, nonceNumber, customCommon, myData, rawTx, tx, serializedTx, receipt;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                event.preventDefault();\n\n                _this.setState({\n                  loading: true,\n                  errorMessage: \"\",\n                  successMessage: \"\"\n                });\n\n                timestamp = +new Date();\n                console.log(timestamp);\n                e = _this.props.event;\n                decodedData = decodeData(e);\n                dataID = parseInt(e.topics[2], 16);\n                addressFrom = _this.state.buyer_add;\n                transferValue = decodedData[2]._hex; // const recipient = \"0x\" + e.topics[1].substr(26, 64);\n\n                recipient = \"0xa1b9207bff69cc6149c13b820576403631f0b39d\"; // console.log('1 ' + dataID);\n                // console.log('2 ' + addressFrom);\n                // console.log('3 ' + transferValue);\n                // console.log('4 ' + recipient);\n\n                privateKey = new Buffer.from(\"e8d1574304a68b5f794d33a842389350d93e49d46b6871571f9b64eaa53131ec\", \"hex\");\n                _context.t0 = web3.utils;\n                _context.next = 14;\n                return web3.eth.getTransactionCount(addressFrom, \"pending\");\n\n              case 14:\n                _context.t1 = _context.sent;\n                nonceNumber = _context.t0.toHex.call(_context.t0, _context.t1);\n                //console.log(nonceNumber);\n                customCommon = Common.forCustomChain(\"mainnet\", {\n                  name: \"TestNetwork\",\n                  networkId: 7777,\n                  chainId: 7777\n                }, \"petersburg\");\n                myData = contract2.methods.EmitEvent(recipient, transferValue, dataID, timestamp.toString()).encodeABI();\n                rawTx = {\n                  nonce: nonceNumber,\n                  from: addressFrom,\n                  gasLimit: web3.utils.toHex(100000),\n                  gasPrice: web3.utils.toHex(10e9),\n                  to: contract2._address,\n                  data: myData,\n                  value: transferValue\n                };\n                tx = new Tx.Transaction(rawTx, {\n                  common: customCommon\n                });\n                tx.sign(privateKey);\n                serializedTx = tx.serialize();\n                _context.next = 24;\n                return web3.eth.sendSignedTransaction(\"0x\" + serializedTx.toString(\"hex\")).on(\"receipt\", console.log);\n\n              case 24:\n                receipt = _context.sent;\n\n                _this.setState({\n                  successMessage: \"Transaction successfull, transaction hash: \" + receipt.transactionHash\n                });\n\n              case 26:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    return _this;\n  }\n\n  _createClass(Show, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var e = this.props.event;\n      var decodedData = decodeData(e);\n      var txHash = e.transactionHash;\n      var blockHash = e.blockNumber;\n      var blockNumber = e.blockNumber;\n      var dataOwner = \"0x\" + e.topics[1].substr(26, 64).toUpperCase();\n      var dataType = getTags(e);\n      var dataID = parseInt(e.topics[2], 16);\n      var cost = decodedData[2]._hex;\n      var timestamp = new Date(parseInt(decodedData[1])).toLocaleString();\n      var colour = \"yellow\";\n      return /*#__PURE__*/_jsxDEV(Layout, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Table, {\n            color: colour,\n            children: [/*#__PURE__*/_jsxDEV(Table.Header, {\n              children: /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.HeaderCell, {\n                  children: \"Property\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 120,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.HeaderCell, {\n                  children: \"Value\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 121,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 119,\n                columnNumber: 15\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 118,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(Table.Body, {\n              children: [/*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Transaction Hash:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 127,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: txHash\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 128,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 126,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Block Hash:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 131,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: blockHash\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 132,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 130,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Block Number:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 135,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: blockNumber\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 136,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Data Owner:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 139,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: dataOwner\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 140,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 138,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Data Tags:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 143,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: dataType\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 144,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 142,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Data ID:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 147,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: dataID\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 148,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 146,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Data Cost:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 151,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: [parseInt(cost, 16), \" ETH\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 152,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 150,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(Table.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: \"Timestamp:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Table.Cell, {\n                  children: timestamp\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 156,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 154,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 125,\n              columnNumber: 13\n            }, this)]\n          }, colour, true, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(Form, {\n            onSubmit: this.onSubmit,\n            error: !!this.state.errorMessage,\n            success: !!this.state.successMessage,\n            children: /*#__PURE__*/_jsxDEV(Grid, {\n              children: [/*#__PURE__*/_jsxDEV(Grid.Row, {\n                children: [/*#__PURE__*/_jsxDEV(Grid.Column, {\n                  width: 8,\n                  children: /*#__PURE__*/_jsxDEV(Form.Input, {\n                    flex: true,\n                    label: {\n                      children: \"Your Address:\",\n                      style: {\n                        fontSize: '16px'\n                      }\n                    },\n                    placeholder: \"0xabcd1234\",\n                    id: \"buyer_add\",\n                    value: this.state.buyer_add,\n                    onChange: function onChange(event) {\n                      return _this2.setState({\n                        buyer_add: event.target.value\n                      });\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 164,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 163,\n                  columnNumber: 15\n                }, this), /*#__PURE__*/_jsxDEV(Grid.Column, {\n                  verticalAlign: \"middle\",\n                  width: 5,\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    loading: this.state.loading,\n                    primary: true,\n                    children: [\"Buy for \", parseInt(cost, 16), \" ETH\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 174,\n                    columnNumber: 17\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 173,\n                  columnNumber: 15\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 162,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(\"h4\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 177,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(Message, {\n                error: true,\n                header: \"Oops!\",\n                content: this.state.errorMessage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 178,\n                columnNumber: 13\n              }, this), /*#__PURE__*/_jsxDEV(Message, {\n                success: true,\n                header: \"Completed!\",\n                content: this.state.successMessage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 13\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 7\n      }, this);\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(props) {\n        var address, results, decodedEvents, aux, index, event;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                address = props.query.address;\n                _context2.next = 3;\n                return getEvents();\n\n              case 3:\n                results = _context2.sent;\n                decodedEvents = results.events;\n\n                aux = function aux(item) {\n                  return item.transactionHash === address;\n                };\n\n                index = decodedEvents.findIndex(aux);\n                event = decodedEvents[index];\n                return _context2.abrupt(\"return\", {\n                  event: event\n                });\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function getInitialProps(_x2) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return Show;\n}(Component);\n\nexport default Show;","map":{"version":3,"sources":["/home/paulo/Desktop/Private_Blockchain/Web/WebApp/pages/data/show.js"],"names":["React","Component","Form","Button","Message","Table","Grid","Modal","Layout","getEvents","getTags","decodeData","web3","contract2","Common","Tx","require","Show","buyer_add","errorMessage","successMessage","loading","event","preventDefault","setState","timestamp","Date","console","log","e","props","decodedData","dataID","parseInt","topics","addressFrom","state","transferValue","_hex","recipient","privateKey","Buffer","from","utils","eth","getTransactionCount","nonceNumber","toHex","customCommon","forCustomChain","name","networkId","chainId","myData","methods","EmitEvent","toString","encodeABI","rawTx","nonce","gasLimit","gasPrice","to","_address","data","value","tx","Transaction","common","sign","serializedTx","serialize","sendSignedTransaction","on","receipt","transactionHash","txHash","blockHash","blockNumber","dataOwner","substr","toUpperCase","dataType","cost","toLocaleString","colour","onSubmit","children","style","fontSize","target","address","query","results","decodedEvents","events","aux","item","index","findIndex"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Form, Button, Message, Table, Grid, Modal } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport getEvents from \"../../components/getEvents\";\nimport getTags from \"../../components/getTags\";\nimport decodeData from \"../../components/decodeData\";\nimport web3 from \"../../Ethereum/web3\";\nimport contract2 from \"../../Ethereum/contract2\";\nimport Common from \"ethereumjs-common\";\nvar Tx = require(\"ethereumjs-tx\");\n\nclass Show extends Component {\n\n  state = {\n    buyer_add: \"\",\n    errorMessage: \"\",\n    successMessage: \"\",\n    loading: false,\n  };\n\n  static async getInitialProps(props) {\n    const address = props.query.address;\n    const results = await getEvents();\n    const decodedEvents = results.events;\n    const aux = (item) => item.transactionHash === address;\n    const index = decodedEvents.findIndex(aux);\n    const event = decodedEvents[index];\n    return { event };\n  }\n\n  onSubmit = async (event) => {\n    event.preventDefault();\n    this.setState({ loading: true, errorMessage: \"\", successMessage: \"\" });\n\n    const timestamp = +new Date();\n    console.log(timestamp);\n\n    const e = this.props.event;\n    const decodedData = decodeData(e);\n\n    const dataID = parseInt(e.topics[2], 16);\n    const addressFrom = this.state.buyer_add;\n    const transferValue = decodedData[2]._hex;\n    // const recipient = \"0x\" + e.topics[1].substr(26, 64);\n\n    const recipient = \"0xa1b9207bff69cc6149c13b820576403631f0b39d\";\n    // console.log('1 ' + dataID);\n    // console.log('2 ' + addressFrom);\n    // console.log('3 ' + transferValue);\n    // console.log('4 ' + recipient);\n\n    var privateKey = new Buffer.from(\n      \"e8d1574304a68b5f794d33a842389350d93e49d46b6871571f9b64eaa53131ec\",\n      \"hex\"\n    );\n    var nonceNumber = web3.utils.toHex(\n      await web3.eth.getTransactionCount(addressFrom, \"pending\")\n    );\n    //console.log(nonceNumber);\n    const customCommon = Common.forCustomChain(\n      \"mainnet\",\n      {\n        name: \"TestNetwork\",\n        networkId: 7777,\n        chainId: 7777,\n      },\n      \"petersburg\"\n    );\n\n    var myData = contract2.methods\n      .EmitEvent(\n        recipient,\n        transferValue,\n        dataID,\n        timestamp.toString(),\n      )\n      .encodeABI();\n\n    var rawTx = {\n      nonce: nonceNumber,\n      from: addressFrom,\n      gasLimit: web3.utils.toHex(100000),\n      gasPrice: web3.utils.toHex(10e9),\n      to: contract2._address,\n      data: myData,\n      value: transferValue\n    };\n\n    var tx = new Tx.Transaction(rawTx, { common: customCommon });\n    tx.sign(privateKey);\n    var serializedTx = tx.serialize();\n\n    var receipt = await web3.eth\n      .sendSignedTransaction(\"0x\" + serializedTx.toString(\"hex\"))\n      .on(\"receipt\", console.log);\n\n      this.setState({successMessage: \"Transaction successfull, transaction hash: \" + receipt.transactionHash});\n  }\n\n  render() {\n    const e = this.props.event;\n    const decodedData = decodeData(e);\n    const txHash = e.transactionHash;\n    const blockHash = e.blockNumber;\n    const blockNumber = e.blockNumber;\n    const dataOwner = \"0x\" + e.topics[1].substr(26, 64).toUpperCase();\n    const dataType = getTags(e);\n    const dataID = parseInt(e.topics[2], 16);\n    const cost = decodedData[2]._hex;\n    const timestamp = new Date(parseInt(decodedData[1])).toLocaleString();\n\n    const colour = \"yellow\";\n\n    return (\n      <Layout>\n        <div>\n          <Table color={colour} key={colour}>\n            <Table.Header>\n              <Table.Row>\n                <Table.HeaderCell>Property</Table.HeaderCell>\n                <Table.HeaderCell>Value</Table.HeaderCell>\n              </Table.Row>\n            </Table.Header>\n\n            <Table.Body>\n              <Table.Row>\n                <Table.Cell>Transaction Hash:</Table.Cell>\n                <Table.Cell>{txHash}</Table.Cell>\n              </Table.Row>\n              <Table.Row>\n                <Table.Cell>Block Hash:</Table.Cell>\n                <Table.Cell>{blockHash}</Table.Cell>\n              </Table.Row>\n              <Table.Row>\n                <Table.Cell>Block Number:</Table.Cell>\n                <Table.Cell>{blockNumber}</Table.Cell>\n              </Table.Row>\n              <Table.Row>\n                <Table.Cell>Data Owner:</Table.Cell>\n                <Table.Cell>{dataOwner}</Table.Cell>\n              </Table.Row>\n              <Table.Row>\n                <Table.Cell>Data Tags:</Table.Cell>\n                <Table.Cell>{dataType}</Table.Cell>\n              </Table.Row>\n              <Table.Row>\n                <Table.Cell>Data ID:</Table.Cell>\n                <Table.Cell>{dataID}</Table.Cell>\n              </Table.Row>\n              <Table.Row>\n                <Table.Cell>Data Cost:</Table.Cell>\n                <Table.Cell>{parseInt(cost, 16)} ETH</Table.Cell>\n              </Table.Row>\n              <Table.Row>\n                <Table.Cell>Timestamp:</Table.Cell>\n                <Table.Cell>{timestamp}</Table.Cell>\n              </Table.Row>\n            </Table.Body>\n          </Table>\n          <Form onSubmit={this.onSubmit} error={!!this.state.errorMessage} success={!!this.state.successMessage}>\n          <Grid>\n            <Grid.Row>\n              <Grid.Column width={8}>\n                    <Form.Input\n                      flex\n                      label={{ children: \"Your Address:\", style:{ fontSize: '16px' } }}\n                      placeholder=\"0xabcd1234\"\n                      id=\"buyer_add\"\n                      value={this.state.buyer_add}\n                      onChange={(event) => this.setState({ buyer_add: event.target.value })}\n                    />\n              </Grid.Column>\n              <Grid.Column verticalAlign='middle' width={5}>\n                <Button loading={this.state.loading} primary>Buy for {parseInt(cost, 16)} ETH</Button>\n              </Grid.Column>\n            </Grid.Row>\n            <h4></h4>\n            <Message error header=\"Oops!\" content={this.state.errorMessage} />\n            <Message success header=\"Completed!\" content={this.state.successMessage} />\n          </Grid>\n          </Form>\n          </div>\n      </Layout>\n    );\n  }\n}\nexport default Show;\n"]},"metadata":{},"sourceType":"module"}